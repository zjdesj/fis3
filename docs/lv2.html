<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="_FIS_构建工具_前端工具框架" />
    <meta name="keywords" content=",百度前端团队,FIS,百度FIS,百度前端,fis,前端模块化,前端工程,性能优化,web performance" />
    <link rel="shortcut icon" href="/fis3/static/images/favicon-fis.ico"/>
    <title>FIS3 :  中级使用</title>
    <meta name="description" content="FIS3 面向前端的工程构建系统">
    <meta name="author" content="fis-team">
    
    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="/fis3/static/css/common_3a72140.css">
    <!-- Custom styles -->
    <link href="/fis3/static/css/page_98ef07b.css" rel="stylesheet" type="text/css" media="all">
    <link href="/fis3/static/css/github_5dbe7fc.css" rel="stylesheet" type="text/css" media="all">
    <link href="/fis3/static/css/perfect-scrollbar.min_0321076.css" rel="stylesheet">
    <script type="text/javascript">
        //检查页面域名
        (function(){
            var url = window.location.href;
            if (url.indexOf('http://fex.baidu.com/fis-site') !== -1) {
                window.location.href = url.replace('http://fex.baidu.com/fis-site','http://fis.baidu.com');
            }
        })();
    </script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="/fis3/static/js/html5shiv_3855464.js"></script>
    <script src="/fis3/static/js/respond.min_579a7a6.js"></script>
    <![endif]-->

    <script src="/fis3/static/js/jquery.min_8fa4892.js"></script>
    <script src="/fis3/static/js/scrollspy_f211cc4.js"></script>
</head>

<body>

<div class="header-wrap">
    <header>
        <div class="logo-wrap">
            <a href="/fis3/index.html" class="logo"><img src="/fis3/static/images/logo_43c555b.png" width="90" /></a>
            <a class="fa toggle"></a>
        </div>
        <nav>
            <div class="nav-left">
                <a href="/fis3/docs/beginning/intro.html" class="nav-link  is-active">用户文档</a>
                <a target="_blank" href="https://github.com/fex-team/fis3-demo" class="nav-link">Demo</a>
                <a href="/fis3/plugins.html" class="nav-link ">插件列表</a>
                <a href="/fis3/api/index.html" class="nav-link  ">开发API</a>
                <a target="_blank" href="http://fex.baidu.com/fis-site/index.html" class="nav-link">FIS2</a>
            </div>

            <div class="nav-right">
                <a href="https://github.com/fex-team/fis3"><i class="fa fa-github"></i></a>
            </div>
        </nav>
    </header>
</div>

<div id="main" class="fix-sidebar">
    <div class="sidebar">
    <ul>
<li><a href="/fis3/docs/beginning/intro.html">介绍</a></li>
<li><a href="/fis3/docs/beginning/install.html">安装</a></li>
<li>起步<ul>
<li><a href="/fis3/docs/beginning/release.html">构建</a><ul>
<li><a href="/fis3/docs/beginning/release.html#%E4%BE%8B%E5%AD%90">例子</a></li>
<li><a href="/fis3/docs/beginning/release.html#%E5%91%BD%E4%BB%A4">命令</a></li>
<li><a href="/fis3/docs/beginning/release.html#%E8%B5%84%E6%BA%90%E5%AE%9A%E4%BD%8D">资源定位</a></li>
<li><a href="/fis3/docs/beginning/release.html#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">配置文件</a></li>
<li><a href="/fis3/docs/beginning/release.html#%E6%96%87%E4%BB%B6%E6%8C%87%E7%BA%B9">文件指纹</a></li>
<li><a href="/fis3/docs/beginning/release.html#%E5%8E%8B%E7%BC%A9%E8%B5%84%E6%BA%90">压缩资源</a></li>
<li><a href="/fis3/docs/beginning/release.html#CssSprite%E5%9B%BE%E7%89%87%E5%90%88%E5%B9%B6">CssSprite图片合并</a></li>
<li><a href="/fis3/docs/beginning/release.html#%E5%8A%9F%E8%83%BD%E7%BB%84%E5%90%88">功能组合</a></li>
</ul>
</li>
<li><a href="/fis3/docs/beginning/debug.html">调试</a><ul>
<li><a href="/fis3/docs/beginning/debug.html#%E7%9B%AE%E5%BD%95">目录</a></li>
<li><a href="/fis3/docs/beginning/debug.html#%E5%8F%91%E5%B8%83">发布</a></li>
<li><a href="/fis3/docs/beginning/debug.html#%E5%90%AF%E5%8A%A8">启动</a></li>
<li><a href="/fis3/docs/beginning/debug.html#%E9%A2%84%E8%A7%88">预览</a></li>
<li><a href="/fis3/docs/beginning/debug.html#%E6%96%87%E4%BB%B6%E7%9B%91%E5%90%AC">文件监听</a></li>
<li><a href="/fis3/docs/beginning/debug.html#%E6%B5%8F%E8%A7%88%E5%99%A8%E8%87%AA%E5%8A%A8%E5%88%B7%E6%96%B0">浏览器自动刷新</a></li>
<li><a href="/fis3/docs/beginning/debug.html#%E5%8F%91%E5%B8%83%E5%88%B0%E8%BF%9C%E7%AB%AF%E6%9C%BA%E5%99%A8">发布到远端机器</a></li>
<li><a href="/fis3/docs/beginning/debug.html#%E6%9B%BF%E4%BB%A3%E5%86%85%E7%BD%AEServer">替代内置Server</a></li>
</ul>
</li>
<li><a href="/fis3/docs/user-dev/extlang.html">内置语法</a><ul>
<li><a href="/fis3/docs/user-dev/inline.html">内容嵌入</a></li>
<li><a href="/fis3/docs/user-dev/uri.html">定位资源</a></li>
<li><a href="/fis3/docs/user-dev/require.html">声明依赖</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/fis3/docs/build.html">工作原理</a><ul>
<li><a href="/fis3/docs/build.html#%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B">构建流程</a></li>
<li><a href="/fis3/docs/build.html#%E5%8D%95%E6%96%87%E4%BB%B6%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B">单文件编译流程</a></li>
<li><a href="/fis3/docs/build.html#File%E5%AF%B9%E8%B1%A1">File对象</a></li>
</ul>
</li>
<li><a href="/fis3/docs/lv1.html">初级使用</a><ul>
<li><a href="/fis3/docs/lv1.html#%E4%B8%80%E4%B8%AA%E5%A4%8D%E6%9D%82%E7%82%B9%E7%9A%84%E4%BE%8B%E5%AD%90">一个复杂点的例子</a></li>
<li><a href="/fis3/docs/lv1.html#%E5%AE%89%E8%A3%85%E4%B8%80%E4%BA%9B%E6%8F%92%E4%BB%B6">安装一些插件</a></li>
<li><a href="/fis3/docs/lv1.html#%E9%A2%84%E5%A4%84%E7%90%86">预处理</a></li>
<li><a href="/fis3/docs/lv1.html#%E7%AE%80%E5%8D%95%E5%90%88%E5%B9%B6">简单合并</a></li>
<li><a href="/fis3/docs/lv1.html#%E6%9E%84%E5%BB%BA%E8%B0%83%E8%AF%95%E9%A2%84%E8%A7%88">构建调试预览</a></li>
</ul>
</li>
<li><a href="/fis3/docs/lv2.html">中级使用</a><ul>
<li><a href="/fis3/docs/lv2.html#%E9%A2%84%E5%A4%84%E7%90%86%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99">预处理插件编写</a></li>
<li><a href="/fis3/docs/lv2.html#%E6%89%93%E5%8C%85%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99">打包插件编写</a></li>
<li><a href="/fis3/docs/lv2.html#%E5%8F%91%E5%B8%83%E6%8F%92%E4%BB%B6">发布插件</a></li>
</ul>
</li>
<li><a href="/fis3/docs/lv3.html">高级使用</a><ul>
<li><a href="/fis3/docs/lv3.html#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84%E8%A1%A8">静态资源映射表</a></li>
<li><a href="/fis3/docs/lv3.html#%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91">模块化开发</a></li>
<li><a href="/fis3/docs/lv3.html#%E5%9F%BA%E4%BA%8E%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1">资源映射表的模块化方案设计</a></li>
<li><a href="/fis3/docs/lv3.html#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%B0%81%E8%A3%85">解决方案封装</a></li>
<li><a href="/fis3/docs/lv3.html#%E5%9F%BA%E4%BA%8ESmarty%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">基于Smarty的解决方案</a></li>
<li><a href="/fis3/docs/lv3.html#%E5%9F%BA%E4%BA%8E%E7%BA%AFPHP%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">基于纯PHP的解决方案</a></li>
<li><a href="/fis3/docs/lv3.html#%E5%9F%BA%E4%BA%8ELaveral%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">基于Laveral的解决方案</a></li>
</ul>
</li>
<li>接口文档<ul>
<li><a href="/fis3/docs/api/command.html">命令行</a></li>
<li><a href="/fis3/docs/api/config.html">配置</a><ul>
<li><a href="/fis3/docs/api/config-api.html">配置接口</a></li>
<li><a href="/fis3/docs/api/config-props.html">配置属性</a></li>
<li><a href="/fis3/docs/api/config-commonly-used.html">常用配置</a></li>
<li><a href="/fis3/docs/api/config-glob.html">glob</a></li>
</ul>
</li>
<li><a href="/fis3/docs/api/config-system-plugin.html">内置插件及配置</a></li>
<li><a href="/fis3/docs/api/dev-plugin.html">自定义插件</a></li>
</ul>
</li>
<li><a href="/fis3/docs/node-mock.html">mock 假数据模拟</a></li>
<li><a href="/fis3/docs/fis2-to-fis3.html">FIS2 到 FIS3</a></li>
</ul>

    <div class="bottom-shadow"></div>
</div>

    <div class="content api with-sidebar">
        <a name="%E4%B8%AD%E7%BA%A7%E4%BD%BF%E7%94%A8" class="title-anchor"></a><h3 class="" id="中级使用">中级使用</h3><p>在<strong>初级使用</strong>中，为了解析 <code>less</code> 和 进行简单的资源合并，我们安装了两个已经提供好的插件，使用插件完成了我们的工作。假设某些情况下，还没有相关插件，该怎么办？</p>
<p>那么这节讨论一下 FIS 中插件如何编写。在<a href="/fis3/docs/build.html">工作原理</a> 中，已经介绍了整个构建的过程，以及说明了 FIS 与其他构建工具的不同点。</p>
<a name="%E9%A2%84%E5%A4%84%E7%90%86%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99" class="title-anchor"></a><h4 class="" >预处理插件编写</h4><p>假设给定项目中要是用 <code>es6</code>，线上运行时解析成标准 <code>js</code> 性能堪忧，想用自动化工具进行预处理转换。如原理介绍 <code>parser</code> 阶段就是进行归一化的过程，通过预处理阶段，整个文件都会翻译为标准的文件，即浏览器可解析的文件。</p>
<p>这时候我们搜罗开源社区，看转换 <code>es6</code> 到 <code>es5</code> 哪个转换工具更好一些，发现 <code>babel</code> 具有无限的潜能。</p>
<a name="%E4%BB%BB%E5%8A%A1" class="title-anchor"></a><h5 class="" >任务</h5><ul>
<li>预处理 <code>es6</code> 为 <code>es5</code></li>
</ul>
<a name="%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87" class="title-anchor"></a><h5 class="" >前期准备</h5><ul>
<li><code>.es6</code> 后缀最终变为 <code>.js</code></li>
<li>使用 <code>babel</code> 进行 <code>es6</code> 的转换</li>
<li>FIS3 实现一个 <code>parser</code> 类型的插件，取名叫 <code>translate-es6</code>，插件全名 <code>fis3-parser-translate-es6</code></li>
</ul>
<a name="%E5%BC%80%E5%8F%91%E6%8F%92%E4%BB%B6" class="title-anchor"></a><h5 class="" >开发插件</h5><blockquote>
<p><a href="/fis3/docs/api/dev-plugin.html">开发插件</a>文档详细介绍了开发插件的步骤，但为了更友好的进行接下来的工作，我们在这里简述一下整个过程。</p>
</blockquote>
<p>FIS3 支持 <code>local mode</code> 加载一个插件。当你调用一个插件的时候，配置如下：</p>
<pre><code class="hljs lang-js"><span class="hljs-rules">{
  <span class="hljs-rule"><span class="hljs-attribute">parser</span>:<span class="hljs-value"> fis.<span class="hljs-function">plugin</span>(<span class="hljs-string">'translate-es6'</span>)
</span></span></span>}
</code></pre>
<p>如果项目的根目录 <strong>node_modules</strong> 下有这个插件，就能挂载起来。</p>
<pre><code class="hljs lang-bash"><span class="hljs-keyword">my</span>-proj/node_modules/fis3-parser-translate-es6
</code></pre>
<p>这样我们就知道，插件逻辑放到什么地方能用 <code>fis.plugin</code> 接口挂载。</p>
<pre><code class="hljs lang-bash"><span class="hljs-keyword">my</span>-proj/node_modules/fis3-parser-translate-es6/<span class="hljs-keyword">index</span>.js
</code></pre>
<pre><code class="hljs lang-js">// vi index.js
// babel node.js api 只需要 babel-core 即可
<span class="hljs-keyword">var</span> babel = require('babel-core');
module.exports = function (content, file, options) {
  <span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = babel.transform(content, opts);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">result</span>.code; // 处理后的文件内容
}
</code></pre>
<p>如上我们调用 <code>babel-core</code> 封装了一个 <code>fis3-parser</code> 插件。</p>
<p>现在我们要在项目使用它</p>
<pre><code class="hljs lang-bash"><span class="hljs-keyword">my</span>-proj/fis-conf.js <span class="hljs-comment"># 项目 fis3 配置文件</span>
<span class="hljs-keyword">my</span>-proj/node_modules/fis3-parser-translate-es6/<span class="hljs-keyword">index</span>.js <span class="hljs-comment"># 插件逻辑</span>
<span class="hljs-keyword">my</span>-proj/style.es6
<span class="hljs-keyword">my</span>-proj/<span class="hljs-keyword">index</span>.html
</code></pre>
<p><strong>配置使用</strong></p>
<pre><code class="hljs lang-js"><span class="hljs-tag">fis</span><span class="hljs-class">.match</span>(<span class="hljs-string">'*.es6'</span>, {
  <span class="hljs-attribute">parser</span>: fis.<span class="hljs-function">plugin</span>(<span class="hljs-string">'translate-es6'</span>),
  <span class="hljs-attribute">rExt</span>: <span class="hljs-string">'.js'</span> <span class="hljs-comment">// .es6 最终修改其后缀为 .js</span>
})
</code></pre>
<p><strong>构建</strong></p>
<pre><code class="hljs lang-bash">fis3 <span class="hljs-operator"><span class="hljs-keyword">release</span> -<span class="hljs-keyword">d</span> ./<span class="hljs-keyword">output</span></span>
</code></pre>
<a name="%E6%89%93%E5%8C%85%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99" class="title-anchor"></a><h4 class="" >打包插件编写</h4><p>在开始之前，我们需要阐述下<strong>打包</strong>这个名词，打包在前端工程中有两个方面。</p>
<ul>
<li>收集页面用到的 js、css，分别合并这些引用，将资源合并成一个。</li>
<li>打包，对某些资源进行打包，而记录它们打包的信息，譬如某个文件打包到了哪个包文件。</li>
</ul>
<p>其实一般意义上来说，对于第一种情况<strong>收集打包</strong>只适合于纯前端页面，并且要求资源都是静态引入的。假设出现这种情况：</p>
<pre><code class="hljs lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="actionscript">
<span class="hljs-comment">// load common.js and index.js</span>
F.load([
  <span class="hljs-string">'common'</span>,
  <span class="hljs-string">'index'</span>
]);
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<p>需要通过动态脚本去加载的资源，就无法通过工具静态分析来去做合并了。</p>
<p>还有一种情况，如果模板是后端模板，也依然无法做到这一点，因为加载资源只有在运行时、解析时才能确定。</p>
<p>那么对于这类打包合并资源，需要特殊的处理思路。</p>
<ol>
<li>直接将所有资源合并成一个文件，进行整站（整个项目）合并；</li>
<li>通过<strong>配置文件</strong>配置打包，并且合并时记录合并信息，在运行时根据这些打包信息吐给浏览器合适的资源。</li>
</ol>
<p>第一种，粗暴问题多，并且项目足够大时效率明显不合适。我们主要探讨第二种。</p>
<p>FIS3 默认内置了一个打包插件 <code>fis3-packager-map</code>，它根据用户的<strong>配置信息</strong>对资源进行打包。</p>
<pre><code class="hljs lang-js"><span class="hljs-comment">//fis-conf.js</span>
<span class="hljs-tag">fis</span><span class="hljs-class">.match</span>(<span class="hljs-string">'/widget/*.js'</span>, {
  <span class="hljs-attribute">packTo</span>: <span class="hljs-string">'/static/widget_pkg.js'</span>
})
</code></pre>
<p>标明 <code>/widget</code> 目录下的 <strong>js</strong> 被合并成一个文件 <code>widget_pkg.js</code></p>
<p>假设</p>
<pre><code>/widget/<span class="hljs-tag">a</span><span class="hljs-class">.js</span>
/widget/<span class="hljs-tag">b</span><span class="hljs-class">.js</span>
/widget/c<span class="hljs-class">.js</span>
/map.json
</code></pre><p>编译发布后：</p>
<pre><code>/widget/<span class="hljs-tag">a</span><span class="hljs-class">.js</span>
/widget/<span class="hljs-tag">b</span><span class="hljs-class">.js</span>
/widget/c<span class="hljs-class">.js</span>
/static/widget_pkg<span class="hljs-class">.js</span>
/map.json
</code></pre><p>我们前面说过</p>
<pre><code>当某文件包含字符 <span class="hljs-strong">__RESOURCE_MAP__</span> 时，最终静态资源表（资源之间的依赖、合并信息）会替换这个字符。
</code></pre><p>构建后，出现一个合并资源以外，还会产出一张某资源合并到什么文件中的关系信息。</p>
<pre><code class="hljs lang-json">{
  "<span class="hljs-attribute">res</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">widget/a.js</span>": <span class="hljs-value">{
      "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"/widget/a.js"</span></span>,
      "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"js"</span></span>,
      "<span class="hljs-attribute">pkg</span>": <span class="hljs-value"><span class="hljs-string">"p0"</span>
    </span>}</span>,
    "<span class="hljs-attribute">widget/b.js</span>": <span class="hljs-value">{
      "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"/widget/b.js"</span></span>,
      "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"js"</span></span>,
      "<span class="hljs-attribute">pkg</span>": <span class="hljs-value"><span class="hljs-string">"p0"</span>
    </span>}</span>,
    "<span class="hljs-attribute">widget/c.js</span>": <span class="hljs-value">{
      "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"/widget/c.js"</span></span>,
      "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"js"</span></span>,
      "<span class="hljs-attribute">pkg</span>": <span class="hljs-value"><span class="hljs-string">"p0"</span>
    </span>}    
  </span>}</span>,
  "<span class="hljs-attribute">pkg</span>": <span class="hljs-value">{
    "<span class="hljs-attribute">p0</span>": <span class="hljs-value">{
      "<span class="hljs-attribute">uri</span>": <span class="hljs-value"><span class="hljs-string">"/static/widget_pkg.js"</span></span>,
      "<span class="hljs-attribute">has</span>": <span class="hljs-value">[
        <span class="hljs-string">"widget/a.js"</span>,
        <span class="hljs-string">"widget/b.js"</span>,
        <span class="hljs-string">"widget/c.js"</span>
      ]</span>,
      "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-string">"js"</span>
    </span>}
  </span>}
</span>}
</code></pre>
<a name="%E5%8F%91%E5%B8%83%E6%8F%92%E4%BB%B6" class="title-anchor"></a><h4 class="" >发布插件</h4><p>FIS3 的插件都放在 NPM 平台上，把插件发布到其上即可。</p>
<p>参考链接 <a href="https://docs.npmjs.com/getting-started/publishing-npm-packages">npm publish</a></p>
<p>发布的插件如何使用</p>
<ul>
<li><code>npm install -g &lt;plugin&gt;</code> 安装插件</li>
<li>FIS3 配置文件中按照配置规则进行配置，<code>fis.plugin(&lt;plugin-name&gt;)</code></li>
</ul>
<blockquote class="warning"><p>文档内容有误，可提 PR，文档地址: <i class="fa fa-github"></i><a href="https://github.com/fex-team/fis3/blob/dev/doc/docs/lv2.md">/doc/docs/lv2.md</a></p></blockquote>
    </div>
</div>

<script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F4206d67a3ea708c0d2a9354c8d88525f' type='text/javascript'%3E%3C/script%3E"));
</script>


<!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="/fis3/static/js/perfect-scrollbar.min_5c71541.js"></script>
<script type="text/javascript">
    (function(){
        var scrollBarEnabled = false;

        function isIE( version, comparison ){
            var $div = $('<div style="display:none;"/>').appendTo($('body'));
            $div.html('<!--[if '+(comparison||'')+' IE '+(version||'')+']><a>&nbsp;</a><![endif]-->');
            var ieTest = $div.find('a').length;
            $div.remove();
            return ieTest;
        }

        function updateScrollBar(){
            function enableScrollBar(){
                if (scrollBarEnabled)
                    return;
                scrollBarEnabled = true;
                $(".sidebar").perfectScrollbar({
                    wheelSpeed: 10,
                    wheelPropagation: false
                });
            }

            function disableScrollBar(){
                if (!scrollBarEnabled)
                    return;
                scrollBarEnabled = false;
                $(".sidebar").perfectScrollbar('destroy');
            }

            if ($(window).width()>760 && $(".sidebar").height() < $(".sidebar ul").height()){
                enableScrollBar();
            }else{
                disableScrollBar();
            }
        }

        //设置链接当前样式
        function setActive(){
            var href= window.location.href;
            $(".sidebar li a").each(function(){
                var link = $(this).attr("href");
                if(String(href).indexOf(link) > -1){
                    $(this).addClass("active");
                }
            })
        }

        //生成左边导航用于在移动端查看使用
        function buildSideNav(){
            $("nav .nav-left").clone().attr("class","main-nav").prependTo($(".sidebar"));
            
            $(".header-wrap .toggle").addClass("fa-list").on("click",function(){
                $(".sidebar").toggleClass("open");
                return false;
            })

            $("html").on("click",function(e){
                console.log(e.target);
                $(".sidebar").removeClass("open");
            })

            $(".sidebar").bind("click",function(e){
                e && e.stopPropagation();
            })
        }

        //hash平滑滚动，a链接添加active
        $('.sidebar li a').click(function(){                 
            $('.sidebar li a').removeClass("active");
            $(this).addClass("active");  
            $(".sidebar").removeClass("open");        
        });

        setActive();
        buildSideNav();


        if (!isIE(8, 'lte')){
            $(".sidebar").addClass('scrollbar');
            updateScrollBar();
            $(window).resize(updateScrollBar);
        }



        //判断滚动方向，动态隐藏导航条
        var lastScrollTop = 0;
        $(window).scroll(function(event){
            if($(window).width()>720){
                var st = $(this).scrollTop();
                var range = st - lastScrollTop;
                if(range > 5){
                    $("body").addClass("hide-header");
                }else if(range < -5){
                    $("body").removeClass("hide-header");
                }
            }else{
                $("body").removeClass("hide-header");
            }        
            lastScrollTop = st;
        });
    }());
</script>
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?58781c9e97848ee4bfe5b036058c99e7";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>
